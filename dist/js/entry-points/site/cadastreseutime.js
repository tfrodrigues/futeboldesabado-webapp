var ko=require("knockout"),base=require("../../common/base"),crud=require("../../common/crud"),utils=require("../../common/utils"),cryptoJS=require("crypto-js");ViewModel=function(){var e=this;e.dataModel={},e.cidadeList=ko.observableArray([]),e.estadoList=ko.observableArray([]),e.equipeList=ko.observableArray([]),base.findAll("estado",e.estadoList,{},function(){}),base.findAll("equipe",e.equipeList,{},function(){}),e.saveEquipe=function(){if(e.errorMessageList=ko.observableArray([]),e.errorFieldList=ko.observableArray([]),e.dataModel.siglaEstado=e.dataModel.estado.sigla,e.validateExistingData()){e.dataModel.senha=cryptoJS.enc.Base64.stringify(cryptoJS.HmacSHA1(e.dataModel.senha,"futebolDeSabadoPassKey"));var a=e.dataModel.pagina+e.dataModel.email+e.dataModel.senha,o=cryptoJS.enc.Base64.stringify(cryptoJS.HmacSHA1(a,"futebolDeSabadoSessionKey"));document.cookie="SESSION_ID="+o+";path=/",crud.save("equipe",e.dataModel,function(){window.location="/"+e.dataModel.pagina})}},e.validateExistingData=function(){var a,o,r;if(e.equipeList())for(var s=0;s<=e.equipeList().length-1;s++)a=e.equipeList()[s].nome,o=e.equipeList()[s].pagina,r=e.equipeList()[s].email,a&&a.toLowerCase()===e.dataModel.nome.toLowerCase()&&(e.errorMessageList.push("- Nome já cadastrado."),e.errorFieldList.push("nome")),o&&o.toLowerCase()===e.dataModel.pagina.toLowerCase()&&(e.errorMessageList.push("- Página já cadastrada."),e.errorFieldList.push("pagina")),r&&r.toLowerCase()===e.dataModel.email.toLowerCase()&&(e.errorMessageList.push("- Email já cadastrado."),e.errorFieldList.push("email")),r&&r.toLowerCase()===e.dataModel.email.toLowerCase()&&(e.errorMessageList.push("- Email já cadastrado."),e.errorFieldList.push("email"));return e.dataModel.senha!=e.dataModel.confirmarSenha&&(e.errorMessageList.push("- Senha e Confirmar Senha devem ser iguais."),e.errorFieldList.push("senha"),e.errorFieldList.push("confirmarSenha")),e.errorMessageList().length>0?(utils.showErrorMessage(e.errorMessageList(),e.errorFieldList()),!1):!0},e.loadCidades=function(){e.dataModel.estado&&(e.cidadeList.removeAll(),ko.utils.arrayPushAll(e.cidadeList,e.dataModel.estado.cidades))},ko.utils.extend(e,new crud.ViewModel("equipe",e.dataModel))},ko.applyBindings(new ViewModel,document.getElementById("main"));